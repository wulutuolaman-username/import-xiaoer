如果模块安装失败，请到模之屋下载[本地安装版](https://www.aplaybox.com/details/model/j8uwC55rjW4G)
### 一、使用预设
1. 基础功能完善，导入预设后不会再出现大量图像、节点组的副本，面部定位不会出现X旋转-90°。可以导入FBX模型的预设。
   
2. 如果在偏好设置了包含所有预设文件的预设目录，并且开启了自动查找预设开关，那么代码将会根据预设文件名和模型名称进行匹配，深度检索功能具有更强大的查找预设能力。
    <img width="199" height="22" alt="image" src="https://github.com/user-attachments/assets/5550a316-68a0-492a-8183-a44d2f134a0b" />

如果按下按钮没有反应，你需要检查：
1.是否在偏好设置了预设目录
2.预设文件是否在预设目录内
3.预设文件名称和模型名称是否对的上（例如茜特菈莉的模型错了一个字），需要修改名称以匹配，或开启深度检索

![image](https://github.com/user-attachments/assets/9d73da1b-0d19-48b8-89be-6f282386d39a)![image](https://github.com/user-attachments/assets/257520f0-2710-40aa-bf40-760cd8b4f951)

不排除因为名称相近导入错误的预设（如黑塔和大黑塔），这种情况需要开启深度检索，或关闭自动查找预设开关，点击手动导入预设文件。

3.全选模型/选中模型
选中具有形态键、未完成导入的网格物体。

4.旋转灯光
使用本插件1.1.0+版本导入的所有预设，可在插件面板同时操控所有灯光的方向。

5.重命名选项

<img width="576" height="57" alt="image" src="https://github.com/user-attachments/assets/dcc35651-d8ee-466c-85e1-836bf53cef0d" />

如果在一个工程内连续导入多个预设，可能需要管理工程的资产文件  。
开启此开关后，导入预设将将把模型相关的所有物体移入新集合（集合名称为处理以后的文件名），与模型相关的图像、材质、节点组、驱动物体等都会添加下划线和角色名称作为后缀，以防止混乱。
FBX模型、长名称模型和长名称材质不要开启重命名材质。

### 二、获取预设
可以直接点击前往爱发电或模之屋下载预设。

# 建议熟悉着色节点、几何节点和小二节点结构，再使用制作预设功能
# 推荐使用小二已做好的预设
# 制作预设需要的贴图和预设模板需要自己搞定
# 注意预设模板不是预设，模板制作可以参考[模板示范](https://www.bilibili.com/video/BV1tiuzzeECH)
# 加载预设模板后还需要手动修改，比如换贴图、调参数、修描边、做特效等，可以参考[测试视频](https://www.bilibili.com/video/BV1Yi88zNERk)

### 三、制作预设 
1. 在偏好设置预设目录：导入预设的目录和导出预设的位置。
2. 是否开启导入贴图：默认开启，也可以关闭，只导入节点组、输入材质等。
3. 贴图路径可以用三种方式设置：
   1.搜索贴图：在偏好设置贴图目录，如果模型名称和贴图目录里对应的贴图文件夹名称对应，可以开启搜索贴图。
   2.指定路径：直接指定一个贴图文件夹。
   3.模型路径：从模型文件所处位置获取贴图，确保具有完整贴图，部分FBX模型无法获取。
4. 匹配贴图：使用图像感知哈希对模型的基础贴图和贴图文件夹的基础贴图进行匹配，将模型贴图与其汉明距离最小的基础贴图作为一对匹配。
5. 在列表选择游戏，加载对应的预设模板，如果开启了导入贴图，代码将会导入贴图文件夹里的所有贴图，先匹配基础贴图，再根据基础贴图的名称搜索其他贴图。
6. 代码将会根据材质的名称进行分组，随后在blender信息窗口中汇报分组结果 [材质分组](https://github.com/wulutuolaman-username/import-xiaoer/blob/main/材质/材质分类.py)
7. 随后应用几何节点组，根据分组结果输入材质
8. 根据材质分组结果应用不同的着色节点组，如果开启了导入贴图还会应用贴图
9. 最后绑定定位到头部

### 检测透明材质

<img width="199" height="55" alt="image" src="https://github.com/user-attachments/assets/5936e0aa-2577-458c-90d2-ffd83d69ef62" />

射线法：判断透明像素中心是否在材质面UV区域内。检测速度较快, 对单个材质检测结果与面积法基本相同，但是个别面可能检测不如面积法准确。建议对模型整体检测时使用。
面积法：判断透明像素和材质面UV是否相交。检测速度较慢, 对单个材质检测结果与射线法基本相同, 对材质面UV的像素区域检测更加准确。建议对单个材质检测时使用。

检测准确度有待提高，可以尝试。
可以在UV编辑器界面对单个材质进行检测，若检测结果为透明材质将会选中透明面。

### 更新材质分类

<img width="324" height="337" alt="image" src="https://github.com/user-attachments/assets/69ee6a49-7b73-4d53-88fe-06ce823c90da" />

可以在材质属性面板更改材质分类，可以自动更新节点组和材质描边

### 更新材质透明
<img width="84" height="25" alt="image" src="https://github.com/user-attachments/assets/e13ce64c-76b3-407a-908c-46ab30a28c02" />
切换此状态将会自动更新使用贴图alpha混合透明着色或删除透明相关节点，透明材质模式可能使用CLIP或BLEND，需自行切换。

### 最后，引用了[mmd_tools](https://github.com/MMD-Blender/blender_mmd_tools)部分模块
#### 比如面板的操作符和偏好里更新插件的功能，更新插件的时间由于插件包的文件大小和网络速度需要较长时间下载，我测试时需要三五分钟左右
